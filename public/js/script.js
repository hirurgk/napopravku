$(function(){Doctor.init(),Calendar.init(),Record.init()}),Doctor={selectedId:0,init:function(){this.selectDoctor()},selectDoctor:function(){var e=this;$(".table-doctors tr").click(function(){$(".table-doctors tr").removeClass("bg-success"),$(this).addClass("bg-success"),e.selectedId=$(this).data("id"),Record.getTime(e.selectedId,Calendar.selectedDate)})}},Calendar={now:new Date,selectedDate:"0000-00-00",init:function(){$("#calendar").calendarWidget(),this.selectDay()},nextMonth:function(){var e=this;e.now=new Date(e.now.getYear()+1900,e.now.getMonth()+1,e.now.getDate()),$("#calendar").fadeOut(200,function(){$("#calendar").html(""),$("#calendar").calendarWidget({month:e.now.getMonth(),year:e.now.getYear()+1900}),$("#calendar").fadeIn(200)})},prevMonth:function(){var e=this,t=new Date;return(t.getYear()!=e.now.getYear()||t.getMonth()!=e.now.getMonth())&&(e.now=new Date(e.now.getYear()+1900,e.now.getMonth()-1,e.now.getDate()),void $("#calendar").fadeOut(200,function(){$("#calendar").html(""),$("#calendar").calendarWidget({month:e.now.getMonth(),year:e.now.getYear()+1900}),$("#calendar").fadeIn(200)}))},selectDay:function(){var e=this;$("body").on("click","#calendar td:not(.old-day)",function(){$("#calendar td").removeClass("bg-success"),$(this).addClass("bg-success"),e.selectedDate=$(this).data("date"),Record.getTime(Doctor.selectedId,e.selectedDate)})}},Record={selectedId:0,selectedDate:"0000-00-00",init:function(){this.initModal(),this.initSend()},getTime:function(e,t){$this=this,e>0&&"0000-00-00"!=t&&($this.selectedId=e,$this.selectedDate=t,$.ajax({url:"/list/"+e+"/"+t,method:"GET",success:function(e){$("#records").fadeOut(200,function(){$("#records").html(e).fadeIn(200)})}}))},reload:function(){this.getTime($this.selectedId,$this.selectedDate)},initModal:function(){var e=this;$("body").on("click","#table-records tr:not(.bg-danger)",function(){e.hideErrors();var t=$(this).find("td:first-child").html();$(".record-modal #user-time").val(t),$("#user-phone").inputmask("+7(999)999-99-99")})},initSend:function(){var e=this;$("body").on("submit",".record-modal form",function(){var t=$(this).serialize();return t+="&doctor_id="+Doctor.selectedId,t+="&time_of_reception="+Calendar.selectedDate+" "+$("#user-time").val()+":00",e.hideErrors(),$.ajax({url:"/store",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:t,method:"POST",dataType:"json",complete:function(t){var n=t.responseJSON;if("OK"!=t.statusText){for(i in n)$(".record-modal .record-errors").append("<li>"+n[i]+"</li>");$(".record-modal .record-errors").fadeIn(200)}else $(".record-modal .record-form").remove(),$(".record-modal .record-success").fadeIn(200),$(".record-modal").on("hidden.bs.modal",function(){e.reload()})}}),!1})},hideErrors:function(){$(".record-modal .record-errors").html("").hide()}};